{% extends "greenest_admin/base.html" %}
{% load static %}

{% block admin_products_list %}



<!-- Main content area -->
    <div class="col-lg-10 p-0" style="background: #f8f9fa;">
      <div class="main-content">

        <!-- Top section -->
        <div class="content-section d-flex justify-content-between align-items-center flex-wrap">
          <div>
            <h4 class="fw-bold mb-1">Products</h4>
            <div class="text-muted small">Admin &gt; Products</div>
          </div>
          <div class="d-flex align-items-center mt-2 mt-lg-0 me-5 ">
            <form method="GET" class="d-none d-md-block me-5">
    <input 
        name="search"
        class="form-control rounded-pill px-3"
        placeholder="Search product" 
        type="search"
        value="{{ search_query }}"
        style="min-width:200px;"
    >
</form>
            <div class="d-flex align-items-center">

               <a href="{% url "admin_add_product"%}"><button class="btn btn-green px-4 rounded-pill fw-bold" type="button">Add new Product</button></a>
              
            </div>
          </div>
        </div>


<div class="content-section">
  <div class="table-responsive">

  <!-- Table section -->
    <div class="content-section">
      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead>
            <tr>
              <th>#</th>
              <th>Image</th>
              <th>Product</th>
              <th>Category</th>
              <th>Variants</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for product in products %}
<tr>
  <td>{{ forloop.counter0|add:products.start_index }}</td>
  <td>
    {% if product.main_image %}
      <img src="{{ product.main_image.url }}" class="product-img" style="width: 40px; height: 40px; object-fit: cover;">
    {% endif %}
  </td>
  <td>{{ product.name }}</td>
  <td>{{ product.category }}</td>
  <td>{{ product.variants.count }}</td>
  <td>
    {% if product.is_active %}
      <span class="text-success">Active</span>
    {% else %}
      <span class="text-danger">Blocked</span>
    {% endif %}
  </td>
  <td>
    <a href="{% url 'admin_edit_product' product.id %}" class="text-info btn-sm me-1"><i class="bi bi-pencil-square"></i></a>
    <a href="{% url 'admin_delete_product' product.id %}" class="text-danger btn-sm"><i class="bi bi-trash"></i></a>
  </td>
</tr>

<!-- Variants -->
{% for variant in product.variants.all %}
<tr class="variant-row">
  <td></td>
  <td>
    {% for img in variant.images.all %}
      <img src="{{ img.image.url }}" alt="Variant" class="img-fluid" style="width: 35px; height: 35px; object-fit: cover; margin-right: 5px;">
    {% empty %}
      <span class="text-muted small">No images</span>
    {% endfor %}
  </td>
  <td colspan="1" class="ps-5"><b>Variant:</b> {{ variant.variant_type }}</td>
  <td><b>Price:</b> â‚¹{{ variant.price }}</td>
  <td><b>Stock:</b> {{ variant.stock }}</td>
  <td colspan="2"></td>
</tr>
{% empty %}
<tr class="variant-row">
  <td colspan="7" class="text-muted ps-5">No variants for this product.</td>
</tr>
{% endfor %}
{% endfor %}

            
          </tbody>
        </table>
      </div>
      <!-- Pagination as previously described -->
      {% if products.has_other_pages %}
      <nav class="mt-4 d-flex justify-content-center">
        <ul class="pagination mb-0">
          {% if products.has_previous %}
            <li class="page-item"><a class="page-link" href="?page={{ products.previous_page_number }}">Previous</a></li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">Previous</span></li>
          {% endif %}
          {% for num in products.paginator.page_range %}
            {% if products.number == num %}
              <li class="page-item active"><span class="page-link">{{ num }}</span></li>
            {% else %}
              <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
            {% endif %}
          {% endfor %}
          {% if products.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ products.next_page_number }}">Next</a></li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">Next</span></li>
          {% endif %}
        </ul>
      </nav>
      {% endif %}
    </div>

  </div>
</div>

{% endblock admin_products_list %}
