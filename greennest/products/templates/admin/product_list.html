{% extends "greenest_admin/base.html" %}
{% load static %}

 {% block admin_products_list  %}
 <style>
  .main-content {
      background: transparent;
      min-height: 100vh;
      margin: 35px 34px 35px 34px;
    }
    .content-section {
      background: #fff;
      border-radius: 18px;
      padding: 25px 25px;
      box-shadow: 0 4px 18px 0 rgba(36, 113, 74, 0.11);
    }
    .content-section + .content-section {
      margin-top: 25px;
    }
    .product-img {
      width: 40px;
      height: 40px;
      object-fit: cover;
      border-radius: 6px;
    }
 </style>

<!-- Main content area -->
    <div class="col-lg-10 p-0" style="background: #f8f9fa;">
      <div class="main-content">

        <!-- Top section -->
        <div class="content-section d-flex justify-content-between align-items-center flex-wrap">
          <div>
            <h4 class="fw-bold mb-1">Products</h4>
            <div class="text-muted small">Admin &gt; Products</div>
          </div>
          <div class="d-flex align-items-center mt-2 mt-lg-0 me-5 ">
            <form class="d-none d-md-block me-5">
              <input class="form-control rounded-pill px-3" placeholder="Search product" type="search" style="min-width:200px;">
            </form>
            <div class="d-flex align-items-center">

               <a href="{% url "admin_add_product"%}"><button class="btn btn-green px-4 rounded-pill fw-bold" type="button">Add new Product</button></a>
              
            </div>
          </div>
        </div>

        <!-- Table section -->
        <div class="content-section">
          <div class="table-responsive">
            <table class="table align-middle mb-0">
              <thead>
                <tr>
                  <th>Id</th>
                  <th>Image</th>
                  <th>Product</th>
                  <th>Price</th>
                  <th>Stock</th>
                  <th>Category</th>
                  <th>Size</th>
                  <th>Light</th>
                  <th>Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                 {% for product in products %}
                <!-- Example rows -->
                <tr>
                    <td>{{ forloop.counter0|add:products.start_index  }}</td>
                  <td> {% if product.main_image %}
                        <img src="{{ product.main_image.url }}" height="60">
                    {% else %}
                        N/A
                    {% endif %}</td>
                  <td>{{ product.name }}</td>
                  <td>&#8377; {{ product.price }}</td>
                  <td>
                    <span class="form-control form-control-sm text-center d-inline-block" >
                      {{ product.stock }}
                    </span>
                  </td>
                  <td>{{product.category}}</td>
                  <td>{{ product.size }}</td>
                  <td>{{ product.light_requirement }}</td>
                  <td >
                    {% if product.is_active %}
                    <span >Active</span>
                    {% else %}
                    <span >Blocked</span>
                    {% endif %}
                  </td>
                  <td>
                    <a href="{% url 'admin_edit_product' product.id %}" class="btn btn-primary btn-sm">Edit</a>
                    <a href="{% url 'admin_delete_product' product.id %}" 
                      class="btn btn-sm {% if product.is_active %}btn-danger{% else %}btn-success{% endif %}" 
                      onclick="return confirmProductToggle(event, '{{ product.is_active }}')">
                      {% if product.is_active %}Block{% else %}Unblock{% endif %}
                    </a>
                  </td>
                  
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          <!-- Pagination -->
        {% if products.has_other_pages %}
            <nav class="mt-4 d-flex justify-content-center">
              <ul class="pagination mb-0">

                {% if products.has_previous %}
                  <li class="page-item">
                    <a class="page-link" href="?page={{ products.previous_page_number }}">Previous</a>
                  </li>
                {% else %}
                  <li class="page-item disabled"><span class="page-link">Previous</span></li>
                {% endif %}

                {% for num in products.paginator.page_range %}
                  {% if products.number == num %}
                    <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                  {% else %}
                    <li class="page-item">
                      <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                    </li>
                  {% endif %}
                {% endfor %}

                {% if products.has_next %}
                  <li class="page-item">
                    <a class="page-link" href="?page={{ products.next_page_number }}">Next</a>
                  </li>
                {% else %}
                  <li class="page-item disabled"><span class="page-link">Next</span></li>
                {% endif %}

              </ul>
            </nav>
          {% endif %}

        </div>

      </div>
    </div>
        
    
 



  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
function confirmProductToggle(event, isActive) {
    event.preventDefault();

    let link = event.currentTarget;
    let actionText = (isActive === "True") ? "block" : "unblock";

    Swal.fire({
        title: "Are you sure?",
        text: `You are about to ${actionText} this product.`,
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: (isActive === "True") ? "#d33" : "#28a745",
        cancelButtonColor: "#6c757d",
        confirmButtonText: `Yes, ${actionText}!`
    }).then((result) => {
        if (result.isConfirmed) {
            window.location.href = link.href;  // Redirect after confirm
        }
    });

    return false;
}

  document.addEventListener("DOMContentLoaded", function() {
    const paginationLinks = document.querySelectorAll(".pagination .page-link");

    paginationLinks.forEach(link => {
      link.addEventListener("click", function(e) {
        // Optional: smooth scroll to top of product listing
        const target = document.querySelector("#admin_product_list"); // wrap your products in a div with this ID
        if (target) {
          window.scrollTo({
            top: target.offsetTop - 20,
            behavior: "smooth"
          });
        }
      });
    });
  });
</script>


    {% endblock admin_products_list  %}
