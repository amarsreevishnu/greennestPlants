{% extends "base.html" %}
{% load static %}
{% block content %}

<style>
        body { background: #f5f6fa; }
        .wallet-card {
            background: #fff;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.05);
            margin-top: 40px;
        }
        .balance-amount {
            font-size: 2rem;
            font-weight: bold;
        }
        .history {
            max-height: 320px;
            overflow-y: auto;
        }
        .badge-credit { background: #28a745; }
        .badge-debit { background: #dc3545; }
    </style>

<!-- Breadcrumb -->
<div class="container py-3">
  <div class="row">
            {% include "users/user_profile_sidebar.html" %}
    </div>
    
    <!-- Profile Details -->
    <div class="col-md-9 py-2">
        <div class="profile-card">
                       
       
            <h3 class="mb-4 text-center">My Wallet</h3>
            <div class="mb-4 text-center">
                <span class="text-secondary">Current Balance</span><br>
                <span class="balance-amount" id="wallet-balance">₹{{ wallet.balance }}</span>
            </div>
            <div class="mb-3 d-flex justify-content-center">
                
                <a class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addMoneyModal">
                    Add Money
                </a>
            </div>
            <h5 class="mb-3">Transaction History</h5>
            <div class="table-responsive">
    <table class="table table-bordered table-striped text-center align-middle">
        <thead class="table-light">
            <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Amount</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            {% for t in transactions %}
            <tr>
                <td>{{ t.created_at }}</td>
                <td>
                    {% if t.transaction_type == "credit" %}
                        <span class="badge bg-success">Credit</span>
                    {% else %}
                        <span class="badge bg-danger">Debit</span>
                    {% endif %}
                </td>
                <td>₹{{ t.amount }}</td>
                <td>{{ t.description }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" class="text-muted">No transactions yet.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

        

    <!-- Add Money Modal -->
    <div class="modal fade" id="addMoneyModal" tabindex="-1" aria-labelledby="addMoneyModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <form id="add-money-form">
              <div class="modal-header">
                <h5 class="modal-title" id="addMoneyModalLabel">Add Money to Wallet</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <label for="add-amount" class="form-label">Amount</label>
                  <input type="number" class="form-control" id="add-amount" placeholder="Enter amount" required min="1">
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Add Money</button>
              </div>
          </form>
        </div>
      </div>
    </div>      
            
        
      
    </div>
  </div>
</div>
</div>


    <!-- Bootstrap JS and necessary scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Simple JS simulation for adding money (demo only)
        document.getElementById('add-money-form').addEventListener('submit', function(e){
            e.preventDefault();
            const amountInput = document.getElementById('add-amount');
            const addAmount = parseFloat(amountInput.value);
            if (addAmount > 0) {
                // Update balance
                const balanceElem = document.getElementById('wallet-balance');
                let currentBalance = parseFloat(balanceElem.textContent.replace(/[^0-9.-]+/g, ""));
                currentBalance += addAmount;
                balanceElem.textContent = '₹' + currentBalance.toLocaleString('en-IN', {minimumFractionDigits:2});
                // Add history entry
                const historyElem = document.getElementById('wallet-history');
                const newItem = document.createElement("li");
                newItem.classList.add('list-group-item','d-flex','justify-content-between','align-items-center');
                newItem.innerHTML = `Added Money
                    <span class="badge badge-credit text-white px-3 py-1">+ ₹${addAmount}</span>`;
                historyElem.prepend(newItem);
                // Reset and close modal
                amountInput.value = '';
                var modal = bootstrap.Modal.getInstance(document.getElementById('addMoneyModal'));
                modal.hide();
            }
        });
    </script>
{% endblock %}
