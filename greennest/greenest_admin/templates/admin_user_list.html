
{% extends "greenest_admin/base.html" %}
{% load static %}

{% block admin_user_list %}

<div class="col-lg-10 p-0" style="background: #f8f9fa;">
      <div class="main-content">

        <!-- Top section -->
        <div class="content-section d-flex justify-content-between align-items-center flex-wrap">
          <div>
            <h4 class="fw-bold mb-1">Coustomer Details</h4>
            <div class="text-muted small">Admin &gt; Products</div>
          </div>
          <div class="d-flex align-items-center mt-2 mt-lg-0 me-5 ">
            <form class="d-none d-md-block me-3"  method="get" id="search-form">
                <input 
                id="search-input"
                class="form-control rounded-pill px-3" 
                placeholder="Search User" 
                type="search" 
                name="q" 
                value="{{ query }}" 
                oninput="submitForm()" 
                style="min-width:300px;"
                autocomplete="off">
                <span id="clear-btn" class="position-absolute top-0 end-0 me-5 mt-1" style="cursor: pointer; display: none;" onclick="clearInput()">âœ–</span>  
                </form>
            <div class="d-flex align-items-center">  
            </div>
          </div>
        </div>

        <!-- Table section -->
        <div class="content-section">
          <div class="table-responsive">
            <table class="table align-middle mb-0">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Status</th>
                  <th>Address</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                {% for user in users %}
                <tr>
                  <td>{{  forloop.counter0|add:users.start_index }}</td>
                  <td>{{ user.first_name }}</td>
                  <td>{{ user.email }}</td>
                  <td>
                    {% if user.is_active %}
                      Active
                    {% else %}
                      Blocked
                    {% endif %}
                  </td>
                  <td>Nill</td>
                  <td>
                    <form method="POST" action="{% url 'toggle_user_status' user.id %}" onsubmit="return confirmToggle(event, this, {{ user.is_active|yesno:'true,false' }})">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-sm {% if user.is_active %}btn-danger{% else %}btn-success{% endif %}">
                      {% if user.is_active %}Block{% else %}Unblock{% endif %}
                      </button>
                    </form>
                  </td>
                </tr>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          <!-- Pagination -->
          {% if users.has_other_pages %}
    <nav class="mt-4 d-flex justify-content-center">
      <ul class="pagination mb-0">
        {% if users.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?q={{ query }}&page={{ users.previous_page_number }}">Previous</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Previous</span></li>
        {% endif %}

        {% for num in users.paginator.page_range %}
          {% if users.number == num %}
            <li class="page-item active"><span class="page-link">{{ num }}</span></li>
          {% else %}
            <li class="page-item">
              <a class="page-link" href="?q={{ query }}&page={{ num }}">{{ num }}</a>
            </li>
          {% endif %}
        {% endfor %}

        {% if users.has_next %}
          <li class="page-item">
            <a class="page-link" href="?q={{ query }}&page={{ users.next_page_number }}">Next</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">Next</span></li>
        {% endif %}
      </ul>
    </nav>
    {% endif %}
        </div>

      </div>
    </div>





<!-- Bootstrap JS (optional) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


<script>
function toggleClearIcon() {
    const input = document.getElementById('search-input');
    const clearBtn = document.getElementById('clear-btn');
    clearBtn.style.display = input.value.length > 0 ? 'inline-flex' : 'none';
}

function clearInput() {
    const input = document.getElementById('search-input');
    input.value = '';
    toggleClearIcon();
    document.getElementById('search-form').submit();
}

// Auto-submit form as user types
let typingTimer;
function submitForm() {
    clearTimeout(typingTimer);
    typingTimer = setTimeout(() => {
        document.getElementById('search-form').submit();
    }, 500); // wait 500ms after user stops typing
}


function confirmToggle(event, form, isActive) {
    event.preventDefault();
    let actionText = isActive ? "block" : "unblock";
    Swal.fire({
        title: `Are you sure?`,
        text: `You are about to ${actionText} this user.`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: `Yes, ${actionText}!`
    }).then((result) => {
        if (result.isConfirmed) {
            form.submit();
        }
    });
}


</script>


{% endblock admin_user_list %}

