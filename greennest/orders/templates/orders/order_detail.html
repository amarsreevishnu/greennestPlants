{% extends "base.html" %}
{% load static %}
{% block order_details %}

<style>
  .order-header { background: #004F44; color: #fff; text-align: center; }
  .order-status { font-size: 1.1rem; display: flex; align-items: center; gap: 8px; color: #198754; font-weight: 500; margin-bottom: 16px; }
  .address-card { background: #f8f9fa; border-radius: 8px; padding: 22px; margin-bottom: 20px; border: 1px solid #e1e1e1; }
  .products-table th, .products-table td { vertical-align: middle; }
  
</style>

<div class="container my-5">
  <div class="row g-4">
    <div class="text-center">
      <h3>Order Details</h3>
      Order : <strong>#{{ order.display_id }}</strong> | Placed on:<strong>{{ order.created_at|date:"d M Y" }}</strong>
    </div>
    <hr>

    <div class="col-lg-8">
      

      <div class="row g-3 ">
        <div class="col-md-6">
          <div class="">
            <h6>Shipping Address</h6>
            <hr>
            {{ order.address.full_name }}<br>
            {{ order.address.line1 }}, {{ order.address.line2 }}, {{ order.address.city }}, {{ order.address.state }}.<br>
            {{ order.address.phone }}
            <hr>
          </div>
        </div>
        <div class="col-md-6">
          <div class="m-5 ">
            <h6>Payment Method</h6>
            <span>
            {{ order.payment_method }}
            </span>
            <div class="order-status">
              
            </div>
          </div>
        </div>
      </div>
      
      <div class="order-card mt-3">
        <div class="card-header">
          <strong>Products</strong>
        </div>
        <div class="card-body p-0">
          <table class="table table-bordered products-table mb-0">
            <thead class="table-light">
              <tr>
                <th>Product</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Total</th>
                <th>Status / Actions</th>
              </tr>
            <tbody>
  {% for item in items %}
    <tr>
      <td>{{ item.variant.product.name }} ({{ item.variant.variant_type }})</td>
      <td>₹{{ item.price }}</td>
      <td>{{ item.quantity }}</td>
      <td>₹{{ item.total_price }}</td>
      <td>
        {% with item.status|lower as status %}

          {% if order.status in "pending,processing" and item.status == "active" %}
            <a href="{% url 'cancel_order_item' item.id %}" class="btn btn-sm btn-outline-danger">Cancel</a>

          {% elif order.status == "delivered" and item.status == "active" %}
            <a href="{% url 'request_return_item' order.id item.id %}" class="btn btn-sm btn-outline-warning">Return</a>

          {% elif item.status == "cancelled" %}
            <span class="badge bg-danger status-badge">Cancelled</span>

          {% elif item.status == "return_requested" %}
            <span class="badge bg-info text-dark status-badge">Return Requested</span>

          {% elif item.status == "returned" %}
            <span class="badge bg-secondary status-badge">Returned</span>

          {% elif item.status == "return_rejected" %}
            <span class="badge bg-dark text-white status-badge">Return Rejected</span>

          {% else %}
            <span class="badge bg-primary status-badge">{{ item.status|capfirst }} </span>
          {% endif %}

        {% endwith %}
      </td>
    </tr>
    
  {% empty %}
    <tr>
      <td colspan="5" class="text-center">No products found.</td>
    </tr>
    
  {% endfor %}
  
</tbody>

          </table>
        </div>
      </div>
    </div>

    <!-- Right Column - Order Summary -->
    <div class="col-lg-4">
      <div class="cardd">
        <div class="card-header bg-white text-center">
          <strong>Order Summary</strong>
        </div>
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <span>Subtotal</span>
            <span>₹{{ order.final_amount }}</span>
          </div>
          <div class="d-flex justify-content-between">
            <span>Discount</span>
            <span>₹0.00</span>
          </div>
          <div class="d-flex justify-content-between">
            <span>Shipping</span>
            <span>Free</span>
          </div>
          <hr>
          <div class="d-flex justify-content-between fw-bold">
            <span>Total</span>
            <span>₹{{ order.final_amount }}</span>
          </div>
        </div>
      </div>
      

      {% if order.status == "delivered" or order.status == "completed" %}
        <a href="{% url 'download_invoice' order.id %}" class="btn btn-success w-100 mt-2">
          <i class="bi bi-file-earmark-pdf"></i> Download Invoice
        </a>
      {% endif %}
      <a href="{% url 'order_list' %}" class="btn btn-outline-secondary w-100 mt-2">Go Back</a>
    </div>
  </div>
</div>


{% endblock order_details %}
