{% extends "base.html" %}
{% block content %}

<style>
  .payment-container {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 80vh;
    background-color: #f9f9f9;
  }
  .payment-card {
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    text-align: center;
    width: 350px;
  }
  .payment-card h2 {
    margin-bottom: 20px;
    font-size: 24px;
  }
  .amount-label {
    font-size: 20px;
    margin-bottom: 20px;
    color: #333;
  }
  .pay-btn {
    background: #004F44;
    color: #fff;
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
  }
  .pay-btn:hover {
    background: #006d60;
  }
</style>

<div class="payment-container">
  <div class="payment-card">
    <h2 style="color:#004F44;margin-bottom:10px;">Pay with Razorpay</h2>
    <p class="amount-label">Amount: â‚¹{{ amount_in_rupees|floatformat:2 }}</p>
    <button id="rzp-button1" class="pay-btn">Pay Now</button>
  </div>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
var options = {
    "key": "{{ razorpay_key }}",
    "amount": "{{ amount_in_paise }}",  // in paise
    "currency": "INR",
    "name": "Green Nest",
    "description": "Payment for Green Nest order",
    "order_id": "{{ razorpay_order_id }}",
    "handler": function(response){
        var form = document.createElement('form');
        form.method = "POST";
        form.action = "{% url 'razorpay_callback' %}";

        var csrfInput = document.createElement("input");
        csrfInput.type = "hidden";
        csrfInput.name = "csrfmiddlewaretoken";
        csrfInput.value = "{{ csrf_token }}";
        form.appendChild(csrfInput);

        ["razorpay_payment_id","razorpay_order_id","razorpay_signature"].forEach(function(key){
            var hidden = document.createElement("input");
            hidden.type = "hidden";
            hidden.name = key;
            hidden.value = response[key];
            form.appendChild(hidden);
        });

        document.body.appendChild(form);
        form.submit();
    },
    "prefill": {
        "name": "{{ request.user.username }}",
        "email": "{{ request.user.email }}"
    },
    "theme": { "color": "#004F44" },
    "modal": {
    "ondismiss": function(){
        window.location.href = "{% url 'razorpay_failed_payment' %}";
    }
}
};

var rzp1 = new Razorpay(options);
document.getElementById('rzp-button1').onclick = function(e){ rzp1.open(); e.preventDefault(); }
</script>


{% endblock %}
